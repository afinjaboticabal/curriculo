<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gerador de Currículo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .formulario {
      max-width: 700px;
      margin-bottom: 30px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
      margin-bottom: 5px;
    }
    input, textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #0d47a1;
    }

    /* Currículo */
    .curriculo {
      width: 700px;
      border: 1px solid #ccc;
      padding: 80px; /* dobro do espaço das bordas */
      background: #fff;
    }
    .header {
      display: flex;
      align-items: flex-start;
      border-bottom: 2px solid #000;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .header img {
      width: 100px;
      height: 120px;
      object-fit: cover;
      margin-right: 20px;
      border-radius: 6px;
      border: 1px solid #333;
    }
    .header h2 {
      margin: 0;
    }
    .dados-pessoais p {
      margin: 4px 0; /* cada info em linha separada */
    }
    h3 {
      margin-top: 2rem;  /* +1 linha de espaçamento antes de cada seção */
      border-bottom: 1px solid #aaa;
      padding-bottom: 5px;
    }
    /* Espaço extra (≈2 linhas) antes de Objetivo */
    #secaoObjetivo h3 {
      margin-top: 3rem;
    }
    /* Mais respiro entre as seções (embaixo) */
    .section {
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>

  <h1>Gerador de Currículo</h1>
  <div class="formulario">
    <label>Nome completo</label>
    <input type="text" id="nome" />

    <label>Data de nascimento</label>
    <div style="display: flex; gap: 10px;">
      <input type="number" id="dia" placeholder="Dia" min="1" max="31" />
      <input type="number" id="mes" placeholder="Mês" min="1" max="12" />
      <input type="number" id="ano" placeholder="Ano" min="1900" max="2100" />
    </div>

    <label>Nacionalidade</label>
    <input type="text" id="nacionalidade" />

    <label>Endereço</label>
    <input type="text" id="endereco" />

    <label>Telefone</label>
    <div style="display: flex; gap: 10px;">
      <input type="number" id="ddd" placeholder="DDD" min="10" max="99" style="width: 80px;" />
      <input type="text" id="telefone" placeholder="Número" style="flex: 1;" />
    </div>

    <label>Email</label>
    <input type="text" id="email" />

    <label>Foto 3x4</label>
    <input type="file" id="foto" accept="image/*" />

    <label>Objetivo</label>
    <textarea id="objetivo"></textarea>

    <label>Formação</label>
    <textarea id="formacao"></textarea>

    <label>Habilidades</label>
    <textarea id="habilidades"></textarea>

    <label>Cursos Complementares</label>
    <textarea id="cursos"></textarea>

    <label>Experiências</label>
    <textarea id="experiencias"></textarea>

    <label>Informações Complementares</label>
    <textarea id="info"></textarea>

    <button onclick="gerarPDF()">Baixar Currículo</button>
  </div>

  <!-- Pré-visualização -->
  <div class="curriculo" id="preview">
    <div class="header">
      <img id="previewFoto" src="" alt="Foto 3x4" />
      <div>
        <h2 id="previewNome">Seu Nome Aqui</h2>
        <div class="dados-pessoais" id="previewDados"></div>
      </div>
    </div>

    <div id="secaoObjetivo" class="section">
      <h3>Objetivo</h3>
      <p id="previewObjetivo"></p>
    </div>

    <div id="secaoFormacao" class="section">
      <h3>Formação</h3>
      <p id="previewFormacao"></p>
    </div>

    <div id="secaoHabilidades" class="section">
      <h3>Habilidades</h3>
      <p id="previewHabilidades"></p>
    </div>

    <div id="secaoCursos" class="section">
      <h3>Cursos Complementares</h3>
      <p id="previewCursos"></p>
    </div>

    <div id="secaoExperiencias" class="section">
      <h3>Experiências</h3>
      <p id="previewExperiencias"></p>
    </div>

    <div id="secaoInfo" class="section">
      <h3>Informações Complementares</h3>
      <p id="previewInfo"></p>
    </div>
  </div>

  <script>
    const inputs = document.querySelectorAll("input, textarea");
    const fotoInput = document.getElementById("foto");

    inputs.forEach((input) => {
      input.addEventListener("input", atualizarPreview);
    });

    fotoInput.addEventListener("change", () => {
      const file = fotoInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById("previewFoto").src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    function calcularIdade(dia, mes, ano) {
      const hoje = new Date();
      const nascimento = new Date(ano, mes - 1, dia);
      let idade = hoje.getFullYear() - nascimento.getFullYear();
      const m = hoje.getMonth() - nascimento.getMonth();
      if (m < 0 || (m === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
      }
      return idade;
    }

    function formatarTelefone(ddd, numero) {
      numero = (numero || '').replace(/\D/g, "");
      ddd = (ddd || '').toString().replace(/\D/g, "");

      if (!ddd && !numero) return "";
      if (!ddd) return numero; // sem DDD
      if (!numero) return ddd; // sem número

      if (numero.length === 9) {
        return `${ddd} ${numero.substring(0, 5)}-${numero.substring(5)}`;
      } else if (numero.length === 8) {
        return `${ddd} ${numero.substring(0, 4)}-${numero.substring(4)}`;
      } else {
        return `${ddd} ${numero}`; // outros comprimentos, sem hífen
      }
    }

    function atualizarPreview() {
      document.getElementById("previewNome").innerText = document.getElementById("nome").value;

      // Calcular idade
      const dia = document.getElementById("dia").value;
      const mes = document.getElementById("mes").value;
      const ano = document.getElementById("ano").value;

      let dadosHtml = "";
      if (dia && mes && ano) {
        const idade = calcularIdade(dia, mes, ano);
        if (!Number.isNaN(idade)) {
          dadosHtml += `<p><strong>Idade:</strong> ${idade} anos</p>`;
        }
      }
      const nacionalidade = document.getElementById("nacionalidade").value;
      if (nacionalidade) {
        dadosHtml += `<p><strong>Nacionalidade:</strong> ${nacionalidade}</p>`;
      }
      const endereco = document.getElementById("endereco").value;
      if (endereco) {
        dadosHtml += `<p><strong>Endereço:</strong> ${endereco}</p>`;
      }

      // Telefone com DDD e máscara condicional
      const ddd = document.getElementById("ddd").value;
      const tel = document.getElementById("telefone").value;
      const telFmt = formatarTelefone(ddd, tel);
      if (telFmt) {
        dadosHtml += `<p><strong>Telefone:</strong> ${telFmt}</p>`;
      }

      const email = document.getElementById("email").value;
      if (email) {
        dadosHtml += `<p><strong>Email:</strong> ${email}</p>`;
      }

      document.getElementById("previewDados").innerHTML = dadosHtml;

      toggleSection("objetivo", "secaoObjetivo", "previewObjetivo");
      toggleSection("formacao", "secaoFormacao", "previewFormacao");
      toggleSection("habilidades", "secaoHabilidades", "previewHabilidades");
      toggleSection("cursos", "secaoCursos", "previewCursos");
      toggleSection("experiencias", "secaoExperiencias", "previewExperiencias");
      toggleSection("info", "secaoInfo", "previewInfo");
    }

    function toggleSection(inputId, sectionId, previewId) {
      const value = document.getElementById(inputId).value;
      const section = document.getElementById(sectionId);
      if (value.trim() === "") {
        section.style.display = "none";
      } else {
        section.style.display = "block";
        document.getElementById(previewId).innerText = value;
      }
    }

    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const preview = document.getElementById("preview");

      // Captura imagem da div preview
      const canvas = await html2canvas(preview, { scale: 2 });
      const imgData = canvas.toDataURL("image/png");

      const pdf = new jsPDF("p", "mm", "a4");
      const imgProps = pdf.getImageProperties(imgData);
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

      pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
      pdf.save("curriculo.pdf");
    }

    // inicializa preview limpo
    atualizarPreview();
  </script>
</body>
</html>
